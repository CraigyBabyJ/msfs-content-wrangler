<Window
    x:Class="MSFS.ContentWrangler.App.SettingsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
    Title="Settings"
    Icon="/icons/app.ico"
    Width="820"
    Height="560"
    MinWidth="700"
    MinHeight="480"
    WindowStartupLocation="CenterOwner"
    WindowStyle="None"
    AllowsTransparency="False"
    ResizeMode="CanResize"
    Background="{DynamicResource BackgroundBrush}">

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="32"
                            ResizeBorderThickness="5"
                            GlassFrameThickness="0"
                            UseAeroCaptionButtons="False"
                            CornerRadius="10" />
    </shell:WindowChrome.WindowChrome>

    <Grid Background="{DynamicResource BackgroundBrush}">
        <Border x:Name="WindowBorder"
                Margin="0"
                Background="{DynamicResource BackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="10"
                ClipToBounds="True"
                Effect="{DynamicResource WindowShadow}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="32" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Title bar -->
                <Grid Grid.Row="0"
                      Height="32"
                      Background="{DynamicResource SurfaceBrush}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Drag / caption area -->
                    <Border Grid.Column="0"
                            Background="Transparent">
                        <TextBlock Text="Settings"
                                   VerticalAlignment="Center"
                                   Margin="16,0,0,0"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   FontSize="13.5"
                                   FontWeight="SemiBold" />
                    </Border>

                    <!-- Caption buttons -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,0,0">
                        <Button Style="{DynamicResource TitleBarCloseButtonStyle}"
                                shell:WindowChrome.IsHitTestVisibleInChrome="True"
                                ToolTip="Close"
                                Click="OnCloseClicked">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8BB;" />
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Content -->
                <Grid Grid.Row="1" Margin="16">
                    <TabControl x:Name="SettingsTabs"
                                Margin="0,4,0,0">
                        <TabItem Header="Categorization Rules"
                                 ToolTip="Manage rules used to categorize packages into the list filters.">
                            <Grid Margin="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="2*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Categories" Style="{DynamicResource HeaderTextStyle}" />
                                
                                <ListBox Grid.Row="1"
                                         Grid.Column="0"
                                         x:Name="CategoryList"
                                         DisplayMemberPath="Name"
                                         ToolTip="Select a category to edit its patterns."
                                         SelectionChanged="OnCategorySelected" />
                                <WrapPanel Grid.Row="2" Grid.Column="0" Margin="0,8,0,0">
                                    <Button Content="Add..."
                                            ToolTip="Create a new category."
                                            Click="OnAddCategory"
                                            Margin="0,0,6,0" />
                                    <Button Content="Remove"
                                            ToolTip="Remove the selected category."
                                            Click="OnRemoveCategory"
                                            Margin="0,0,6,0" />
                                    <Button Content="Move Up"
                                            ToolTip="Move the selected category up."
                                            Click="OnMoveCategoryUp"
                                            Margin="0,0,6,0" />
                                    <Button Content="Move Down"
                                            ToolTip="Move the selected category down."
                                            Click="OnMoveCategoryDown" />
                                </WrapPanel>

                                <TextBlock Grid.Row="0" Grid.Column="1" x:Name="PatternLabel" Text="Patterns" Margin="8,0,0,0" Style="{DynamicResource HeaderTextStyle}" />
                                <ListBox Grid.Row="1"
                                         Grid.Column="1"
                                         x:Name="PatternList"
                                         Margin="8,0,0,0"
                                         ToolTip="Patterns are substring matches against package names." />

                                <WrapPanel Grid.Row="2" Grid.Column="1" Margin="8,8,0,0">
                                    <TextBox x:Name="PatternInput"
                                             Width="240"
                                             ToolTip="Enter a new pattern (e.g., -airport-, asobo-aircraft-, -livery-)."
                                             Margin="0,0,6,0" />
                                    <Button Content="Add"
                                            ToolTip="Add the pattern to the selected category."
                                            Click="OnAddPattern"
                                            Margin="0,0,6,0" />
                                    <Button Content="Remove Selected Pattern"
                                            ToolTip="Remove the selected pattern from the list."
                                            Click="OnRemovePattern" />
                                </WrapPanel>
                            </Grid>
                        </TabItem>

                        <TabItem Header="Paths"
                                 ToolTip="Choose which Content.xml file the app should use by default.">
                            <StackPanel Margin="12">
                                <TextBlock Text="Content.xml Path:" Style="{DynamicResource HeaderTextStyle}" />
                                <WrapPanel Margin="0,6,0,0">
                                    <TextBox x:Name="ContentPathInput"
                                             Width="520"
                                             ToolTip="Optional. If blank, the app will try to auto-detect Content.xml."
                                             Margin="0,0,6,0" />
                                    <Button Content="Browse..."
                                            ToolTip="Browse to a Content.xml file."
                                            Click="OnBrowseContentXml" />
                                </WrapPanel>
                            </StackPanel>
                        </TabItem>

                        <TabItem Header="Appearance"
                                 ToolTip="Theme, display options, and cache maintenance.">
                            <StackPanel Margin="12">
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Theme" Style="{DynamicResource HeaderTextStyle}" />
                                    <RadioButton x:Name="ThemeDark"
                                                 Content="Dark Theme"
                                                 ToolTip="Use the dark theme."
                                                 GroupName="Theme" />
                                    <RadioButton x:Name="ThemeLight"
                                                 Content="Light Theme"
                                                 ToolTip="Use the light theme."
                                                 GroupName="Theme" />
                                </StackPanel>

                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Display" Style="{DynamicResource HeaderTextStyle}" />
                                    <CheckBox x:Name="ShowThumbnailsCheck"
                                              Content="Show package thumbnails in list"
                                              ToolTip="Show thumbnails in the package grids. Thumbnails are discovered and cached as you scroll." />
                                    <CheckBox x:Name="CleanLegacyCheck"
                                              Content="Clean legacy FS20 mods"
                                              ToolTip="On Save: remove legacy communityfs20-* entries from Content.xml." />
                                </StackPanel>

                                <StackPanel>
                                    <TextBlock Text="Maintenance" Style="{DynamicResource HeaderTextStyle}" />
                                    <Button Content="Clear thumbnail cache"
                                            ToolTip="Delete saved thumbnail mappings. They will be re-discovered as you scroll."
                                            Click="OnClearThumbCache" />
                                </StackPanel>
                            </StackPanel>
                        </TabItem>
                    </TabControl>
                </Grid>

                <!-- Footer -->
                <Border Grid.Row="2"
                        Background="{DynamicResource SurfaceBrush}"
                        BorderBrush="{DynamicResource DividerBrush}"
                        BorderThickness="0,1,0,0"
                        Padding="16,12">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Cancel"
                                Style="{DynamicResource SecondaryActionButton}"
                                Margin="0,0,8,0"
                                ToolTip="Discard changes and close."
                                Click="OnCancelClick" />
                        <Button Content="Save Settings"
                                Style="{DynamicResource PrimaryActionButton}"
                                ToolTip="Save settings and close."
                                Click="OnOkClick" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
