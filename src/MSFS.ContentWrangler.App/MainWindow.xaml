<Window
    x:Class="MSFS.ContentWrangler.App.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:MSFS.ContentWrangler.App"
    xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
    Title="MSFS2024 Content Wrangler"
    Icon="/icons/app.ico"
    MinWidth="980"
    MinHeight="640"
    WindowStartupLocation="Manual"
    WindowStyle="None"
    AllowsTransparency="False"
    ResizeMode="CanResize"
    Background="{DynamicResource BackgroundBrush}">

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="32"
                            ResizeBorderThickness="5"
                            GlassFrameThickness="0"
                            UseAeroCaptionButtons="False"
                            CornerRadius="10" />
    </shell:WindowChrome.WindowChrome>

    <Window.Resources>
        <local:ThumbnailStateToVisibilityConverter x:Key="ThumbMissingVisibility" TargetState="Missing" />
        <local:ThumbnailStateToVisibilityConverter x:Key="ThumbLoadingVisibility" TargetState="Loading" />
        <local:CategoryToGeometryConverter x:Key="CategoryIconConverter" />
        <!-- Keep this converter local so it is available even if theme dictionaries are deferred. -->
        <local:SvgFileToGeometryConverter x:Key="SvgFileToGeometryConverter" />
    </Window.Resources>

    <Grid Background="{DynamicResource BackgroundBrush}">
        <Border x:Name="WindowBorder"
                Margin="0"
                Background="{DynamicResource BackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="10"
                ClipToBounds="True"
                Effect="{DynamicResource WindowShadow}">
            <Grid x:Name="RootGrid">
                <Grid.RowDefinitions>
                    <RowDefinition Height="32" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Title bar -->
                <Grid Grid.Row="0"
                      Height="32"
                      Background="{DynamicResource SurfaceBrush}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Drag / caption area -->
                    <Border Grid.Column="0"
                            Background="Transparent"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <TextBlock x:Name="TitleText"
                                   Text="MSFS2024 Content Wrangler"
                                   VerticalAlignment="Center"
                                   Margin="16,0,0,0"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   FontSize="13.5"
                                   FontWeight="SemiBold" />
                    </Border>

                    <!-- Caption buttons -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,0,0">
                        <Button Style="{DynamicResource TitleBarButtonStyle}"
                                shell:WindowChrome.IsHitTestVisibleInChrome="True"
                                ToolTip="Minimize"
                                Click="OnMinimizeClicked">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE921;" />
                        </Button>
                        <Button Style="{DynamicResource TitleBarButtonStyle}"
                                shell:WindowChrome.IsHitTestVisibleInChrome="True"
                                ToolTip="Maximize / Restore"
                                Click="OnMaximizeRestoreClicked">
                            <TextBlock x:Name="MaximizeGlyph" FontFamily="Segoe MDL2 Assets" Text="&#xE922;" />
                        </Button>
                        <Button Style="{DynamicResource TitleBarCloseButtonStyle}"
                                shell:WindowChrome.IsHitTestVisibleInChrome="True"
                                ToolTip="Close"
                                Click="OnCloseClicked">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8BB;" />
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Toolbar -->
                <Border Grid.Row="1"
                        Margin="16,12,16,0"
                        Padding="12"
                        Background="{DynamicResource SurfaceBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="SwitchContentButton"
                                    Content="Switch Content.xml"
                                    Style="{DynamicResource SubtleButtonStyle}"
                                    ToolTip="Pick from detected Content.xml files under LocalCache."
                                    Click="OnSwitchContentXml"
                                    Margin="0,0,8,0" />
                            <Button x:Name="OpenContentButton"
                                    Content="Open..."
                                    Style="{DynamicResource SubtleButtonStyle}"
                                    ToolTip="Browse to a Content.xml file."
                                    Click="OnOpenContentXml"
                                    Margin="0,0,8,0" />
                            <Button x:Name="ReloadButton"
                                    Content="Reload"
                                    Style="{DynamicResource SubtleButtonStyle}"
                                    ToolTip="Reload the currently selected Content.xml."
                                    Click="OnReload"
                                    Margin="0,0,8,0" />
                            <Button x:Name="SettingsButton"
                                    Content="Settings"
                                    Style="{DynamicResource SubtleButtonStyle}"
                                    ToolTip="Open Settings (appearance, cache, rules, paths)."
                                    Click="OnSettings" />
                        </StackPanel>

                        <Border Margin="0,12,0,0"
                                Padding="12"
                                Background="{DynamicResource SurfaceAltBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="Prefer Community Folder Airports over default"
                                               Style="{DynamicResource HeaderTextStyle}" />
                                    <TextBlock Text="  â€¢  One-click disable them"
                                               Margin="8,2,0,0"
                                               Style="{DynamicResource SecondaryTextStyle}" />
                                </StackPanel>
                                <Button Grid.Column="1"
                                        x:Name="PreferCommunityButton"
                                        Content="Prefer Community Airports"
                                        Style="{DynamicResource SecondaryActionButton}"
                                        Margin="48,0,0,0"
                                        ToolTip="Disable store duplicates so your Community airport takes priority (requires Save)."
                                        Click="OnPreferCommunityAirports" />
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Tabs -->
                <TabControl Grid.Row="2"
                            x:Name="MainTabs"
                            Margin="16,12,16,0"
                            Background="{DynamicResource SurfaceAltBrush}"
                            BorderThickness="0"
                            SelectionChanged="OnTabSelectionChanged">
                     <TabItem x:Name="OfficialTab"
                              Header="Official (FS24)"
                              ToolTip="Packages from the Official (FS24) store content set.">
                        <Grid Margin="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <WrapPanel Grid.Row="0" Margin="0,0,0,10">
                                <TextBox x:Name="OfficialSearchBox"
                                         Width="260"
                                         Margin="0,0,10,0"
                                         Tag="Search packages"
                                         Style="{DynamicResource SearchTextBoxStyle}"
                                         ToolTip="Filter by package name or vendor."
                                         TextChanged="OnOfficialFilterChanged" />
                                <ComboBox x:Name="OfficialCategoryBox"
                                          Width="240"
                                          Margin="0,0,10,0"
                                          Style="{DynamicResource ModernComboBoxStyle}"
                                          ToolTip="Filter by category."
                                          SelectionChanged="OnOfficialFilterChanged" />
                                <ComboBox x:Name="OfficialStatusBox"
                                          Width="240"
                                          Margin="0,0,10,0"
                                          Style="{DynamicResource ModernComboBoxStyle}"
                                          ToolTip="Filter by status."
                                          SelectionChanged="OnOfficialFilterChanged" />
                                <Button x:Name="OfficialActivateButton"
                                        Content="Activate Selected"
                                        Style="{DynamicResource SecondaryActionButton}"
                                        ToolTip="Set selected packages to Activated (requires Save)."
                                        Click="OnActivateSelected" />
                                <Button x:Name="OfficialDisableButton"
                                        Content="Disable Selected"
                                        Margin="8,0,0,0"
                                        Style="{DynamicResource SecondaryActionButton}"
                                        ToolTip="Set selected packages to UserDisabled (requires Save)."
                                        Click="OnDisableSelected" />
                            </WrapPanel>

                            <Border Grid.Row="1"
                                    Background="{DynamicResource SurfaceAltBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                <DataGrid Grid.Row="1" x:Name="OfficialGrid"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          SelectionMode="Extended"
                                          SelectionUnit="FullRow"
                                          CanUserSortColumns="True"
                                          LoadingRow="OnGridLoadingRow"
                                          SelectionChanged="OnGridSelectionChanged">
                                    <DataGrid.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Refresh thumbnail(s)"
                                                      ToolTip="Force re-scan thumbnails for the selected row(s)."
                                                      Click="OnRefreshThumbnailsClicked" />
                                        </ContextMenu>
                                    </DataGrid.ContextMenu>
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn x:Name="OfficialThumbColumn" Header="Thumbnail" Width="190">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Grid Width="170" Height="72">
                                                        <Border CornerRadius="6"
                                                                Background="{DynamicResource SurfaceBrush}"
                                                                BorderBrush="{DynamicResource BorderBrush}"
                                                                BorderThickness="1"
                                                                ToolTip="{Binding ThumbnailToolTip}"
                                                                Effect="{DynamicResource CardShadow}">
                                                            <Grid>
                                                                <Image Source="{Binding ThumbnailImage}" Stretch="UniformToFill" />

                                                                <Border Visibility="{Binding ThumbnailState, Converter={StaticResource ThumbLoadingVisibility}}"
                                                                        Background="#AA1B1B2B">
                                                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                        <ProgressBar Width="80" Height="6" IsIndeterminate="True" />
                                                                        <TextBlock Text="Loading..." Margin="0,6,0,0" Style="{DynamicResource SecondaryTextStyle}" />
                                                                    </StackPanel>
                                                                </Border>

                                                                <Border Visibility="{Binding ThumbnailState, Converter={StaticResource ThumbMissingVisibility}}"
                                                                        Background="#B01B1B2B">
                                                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                        <Path Data="{Binding Category, Converter={StaticResource CategoryIconConverter}}"
                                                                              Fill="{DynamicResource TextSecondaryBrush}"
                                                                              Width="20"
                                                                              Height="20" />
                                                                        <TextBlock Text="No image"
                                                                                   Margin="0,6,0,0"
                                                                                   Style="{DynamicResource SecondaryTextStyle}" />
                                                                    </StackPanel>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
                                        <DataGridTemplateColumn Header="Status" Width="150">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="{Binding Status}"
                                                            Click="OnStatusToggleClicked"
                                                            IsEnabled="{Binding IsToggleable}"
                                                            ToolTip="Click to toggle between Activated and UserDisabled (requires Save)."
                                                            Style="{DynamicResource StatusBadgeButtonStyle}" />
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="160" />
                                        <DataGridTextColumn Header="Vendor" Binding="{Binding Vendor}" Width="160" />
                                        <DataGridTextColumn Header="Sim" Binding="{Binding Sim}" Width="0" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </TabItem>

                     <TabItem x:Name="Official20Tab"
                              Header="Official (FS20)"
                              ToolTip="Packages from the Official (FS20) store content set.">
                        <Grid Margin="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <WrapPanel Grid.Row="0" Margin="0,0,0,10">
                                <TextBox x:Name="Official20SearchBox"
                                         Width="260"
                                         Margin="0,0,10,0"
                                         Tag="Search FS20 packages"
                                         Style="{DynamicResource SearchTextBoxStyle}"
                                         ToolTip="Filter by package name or vendor."
                                         TextChanged="OnOfficial20FilterChanged" />
                                <ComboBox x:Name="Official20CategoryBox"
                                          Width="240"
                                          Margin="0,0,10,0"
                                          Style="{DynamicResource ModernComboBoxStyle}"
                                          ToolTip="Filter by category."
                                          SelectionChanged="OnOfficial20FilterChanged" />
                                <ComboBox x:Name="Official20StatusBox"
                                          Width="240"
                                          Margin="0,0,10,0"
                                          Style="{DynamicResource ModernComboBoxStyle}"
                                          ToolTip="Filter by status."
                                          SelectionChanged="OnOfficial20FilterChanged" />
                                <Button x:Name="Official20ActivateButton"
                                        Content="Activate Selected"
                                        Style="{DynamicResource SecondaryActionButton}"
                                        ToolTip="Set selected packages to Activated (requires Save)."
                                        Click="OnActivateSelected" />
                                <Button x:Name="Official20DisableButton"
                                        Content="Disable Selected"
                                        Margin="8,0,0,0"
                                        Style="{DynamicResource SecondaryActionButton}"
                                        ToolTip="Set selected packages to UserDisabled (requires Save)."
                                        Click="OnDisableSelected" />
                            </WrapPanel>

                            <Border Grid.Row="1"
                                    Background="{DynamicResource SurfaceAltBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                <DataGrid Grid.Row="1" x:Name="Official20Grid"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          SelectionMode="Extended"
                                          SelectionUnit="FullRow"
                                          CanUserSortColumns="True"
                                          LoadingRow="OnGridLoadingRow"
                                          SelectionChanged="OnGridSelectionChanged">
                                    <DataGrid.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Refresh thumbnail(s)"
                                                      ToolTip="Force re-scan thumbnails for the selected row(s)."
                                                      Click="OnRefreshThumbnailsClicked" />
                                        </ContextMenu>
                                    </DataGrid.ContextMenu>
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn x:Name="Official20ThumbColumn" Header="Thumbnail" Width="190">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Grid Width="170" Height="72">
                                                        <Border CornerRadius="6"
                                                                Background="{DynamicResource SurfaceBrush}"
                                                                BorderBrush="{DynamicResource BorderBrush}"
                                                                BorderThickness="1"
                                                                ToolTip="{Binding ThumbnailToolTip}"
                                                                Effect="{DynamicResource CardShadow}">
                                                            <Grid>
                                                                <Image Source="{Binding ThumbnailImage}" Stretch="UniformToFill" />
                                                                <Border Visibility="{Binding ThumbnailState, Converter={StaticResource ThumbLoadingVisibility}}"
                                                                        Background="#AA1B1B2B">
                                                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                        <ProgressBar Width="80" Height="6" IsIndeterminate="True" />
                                                                        <TextBlock Text="Loading..." Margin="0,6,0,0" Style="{DynamicResource SecondaryTextStyle}" />
                                                                    </StackPanel>
                                                                </Border>
                                                                <Border Visibility="{Binding ThumbnailState, Converter={StaticResource ThumbMissingVisibility}}"
                                                                        Background="#B01B1B2B">
                                                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                        <Path Data="{Binding Category, Converter={StaticResource CategoryIconConverter}}"
                                                                              Fill="{DynamicResource TextSecondaryBrush}"
                                                                              Width="20"
                                                                              Height="20" />
                                                                        <TextBlock Text="No image"
                                                                                   Margin="0,6,0,0"
                                                                                   Style="{DynamicResource SecondaryTextStyle}" />
                                                                    </StackPanel>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
                                        <DataGridTemplateColumn Header="Status" Width="150">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="{Binding Status}"
                                                            Click="OnStatusToggleClicked"
                                                            IsEnabled="{Binding IsToggleable}"
                                                            ToolTip="Click to toggle between Activated and UserDisabled (requires Save)."
                                                            Style="{DynamicResource StatusBadgeButtonStyle}" />
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="160" />
                                        <DataGridTextColumn Header="Vendor" Binding="{Binding Vendor}" Width="160" />
                                        <DataGridTextColumn Header="Sim" Binding="{Binding Sim}" Width="0" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </TabItem>

                     <TabItem x:Name="CommunityTab"
                              Header="Community (FS24)"
                              ToolTip="Packages installed under the Community folder (FS24).">
                        <Grid Margin="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <WrapPanel Grid.Row="0" Margin="0,0,0,10">
                                <TextBox x:Name="CommunitySearchBox"
                                         Width="260"
                                         Margin="0,0,10,0"
                                         Tag="Search community"
                                         Style="{DynamicResource SearchTextBoxStyle}"
                                         ToolTip="Filter by package name or vendor."
                                         TextChanged="OnCommunityFilterChanged" />
                                <ComboBox x:Name="CommunityCategoryBox"
                                          Width="240"
                                          Margin="0,0,10,0"
                                          Style="{DynamicResource ModernComboBoxStyle}"
                                          ToolTip="Filter by category."
                                          SelectionChanged="OnCommunityFilterChanged" />
                                <ComboBox x:Name="CommunityStatusBox"
                                          Width="240"
                                          Margin="0,0,10,0"
                                          Style="{DynamicResource ModernComboBoxStyle}"
                                          ToolTip="Filter by status."
                                          SelectionChanged="OnCommunityFilterChanged" />
                                <Button x:Name="CommunityActivateButton"
                                        Content="Activate Selected"
                                        Style="{DynamicResource SecondaryActionButton}"
                                        ToolTip="Set selected packages to Activated (requires Save)."
                                        Click="OnActivateSelected" />
                                <Button x:Name="CommunityDisableButton"
                                        Content="Disable Selected"
                                        Margin="8,0,0,0"
                                        Style="{DynamicResource SecondaryActionButton}"
                                        ToolTip="Set selected packages to UserDisabled (requires Save)."
                                        Click="OnDisableSelected" />
                            </WrapPanel>

                            <Border Grid.Row="1"
                                    Background="{DynamicResource SurfaceAltBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                <DataGrid Grid.Row="1" x:Name="CommunityGrid"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          SelectionMode="Extended"
                                          SelectionUnit="FullRow"
                                          CanUserSortColumns="True"
                                          LoadingRow="OnGridLoadingRow"
                                          SelectionChanged="OnGridSelectionChanged">
                                    <DataGrid.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Refresh thumbnail(s)"
                                                      ToolTip="Force re-scan thumbnails for the selected row(s)."
                                                      Click="OnRefreshThumbnailsClicked" />
                                        </ContextMenu>
                                    </DataGrid.ContextMenu>
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn x:Name="CommunityThumbColumn" Header="Thumbnail" Width="190">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Grid Width="170" Height="72">
                                                        <Border CornerRadius="6"
                                                                Background="{DynamicResource SurfaceBrush}"
                                                                BorderBrush="{DynamicResource BorderBrush}"
                                                                BorderThickness="1"
                                                                ToolTip="{Binding ThumbnailToolTip}"
                                                                Effect="{DynamicResource CardShadow}">
                                                            <Grid>
                                                                <Image Source="{Binding ThumbnailImage}" Stretch="UniformToFill" />

                                                                <Border Visibility="{Binding ThumbnailState, Converter={StaticResource ThumbLoadingVisibility}}"
                                                                        Background="#AA1B1B2B">
                                                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                        <ProgressBar Width="80" Height="6" IsIndeterminate="True" />
                                                                        <TextBlock Text="Loading..." Margin="0,6,0,0" Style="{DynamicResource SecondaryTextStyle}" />
                                                                    </StackPanel>
                                                                </Border>

                                                                <Border Visibility="{Binding ThumbnailState, Converter={StaticResource ThumbMissingVisibility}}"
                                                                        Background="#B01B1B2B">
                                                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                        <Path Data="{Binding Category, Converter={StaticResource CategoryIconConverter}}"
                                                                              Fill="{DynamicResource TextSecondaryBrush}"
                                                                              Width="20"
                                                                              Height="20" />
                                                                        <TextBlock Text="No image"
                                                                                   Margin="0,6,0,0"
                                                                                   Style="{DynamicResource SecondaryTextStyle}" />
                                                                    </StackPanel>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
                                        <DataGridTemplateColumn Header="Status" Width="150">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="{Binding Status}"
                                                            Click="OnStatusToggleClicked"
                                                            IsEnabled="{Binding IsToggleable}"
                                                            ToolTip="Click to toggle between Activated and UserDisabled (requires Save)."
                                                            Style="{DynamicResource StatusBadgeButtonStyle}" />
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="160" />
                                        <DataGridTextColumn Header="Vendor" Binding="{Binding Vendor}" Width="160" />
                                        <DataGridTextColumn Header="Sim" Binding="{Binding Sim}" Width="0" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </TabItem>
                </TabControl>

                <!-- Footer -->
                <Grid Grid.Row="3" Margin="16,12,16,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <TextBlock x:Name="FooterBrand" Grid.Row="0" FontSize="16" FontWeight="SemiBold" />
                    <Grid Grid.Row="1" Margin="0,6,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ItemsControl x:Name="FooterLinks" Grid.Column="0">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{DynamicResource FooterIconButtonStyle}"
                                            Tag="{Binding Uri, Mode=OneWay}"
                                            Click="OnFooterLinkClicked">
                                        <Button.ToolTip>
                                            <StackPanel>
                                                <TextBlock Text="{Binding Label, Mode=OneWay}"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource TextPrimaryBrush}" />
                                                <TextBlock Text="{Binding Uri, Mode=OneWay}"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           TextWrapping="Wrap" />
                                            </StackPanel>
                                        </Button.ToolTip>
                                        <Viewbox Width="18" Height="18" Stretch="Uniform">
                                            <Path Data="{Binding IconFileName, Converter={StaticResource SvgFileToGeometryConverter}}"
                                                  Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                                                  Stretch="Uniform" />
                                        </Viewbox>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                                <Button Grid.Column="1"
                                        x:Name="SaveButton"
                                        Content="Save Changes"
                                        Style="{DynamicResource PrimaryActionButton}"
                                        ToolTip="Write updated package statuses back to Content.xml (creates a backup first)."
                                        Click="OnSaveChanges" />
                    </Grid>
                </Grid>

                <!-- Status bar -->
                <Grid Grid.Row="4" Margin="16,8,16,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock x:Name="StatusText" VerticalAlignment="Center" Style="{DynamicResource SecondaryTextStyle}" />
                    <TextBlock x:Name="PathText"
                               Grid.Column="1"
                               VerticalAlignment="Center"
                               Style="{DynamicResource SecondaryTextStyle}"
                               TextTrimming="CharacterEllipsis"
                               ToolTip="{Binding ElementName=PathText, Path=Text}" />
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
